import * as toolLib from "azure-pipelines-tool-lib/tool";
import path from "path";
import { callApi } from "./utils/services";

export async function runLnxToolBasedInstallationOrExtraction(
  toolToBeUsed: Array<string>,
  tempDirectoryPath: string,
  usecase: string
): Promise<string> {
  let extractPath = tempDirectoryPath;
  for (let i = 0; i < toolToBeUsed.length; i++) {
    const clientToolsDownloadPath = await callApi(
      toolToBeUsed[i],
      tempDirectoryPath
    );

    if (usecase == "" || usecase == "keypair-signing") {
      if (toolToBeUsed[i].includes(".zip")) {
        console.log(
          "tool is in a zip file trying to extract it",
          clientToolsDownloadPath
        );

        await toolLib.extractZip(
          clientToolsDownloadPath as string,
          tempDirectoryPath
        );
        extractPath = path.join(
          tempDirectoryPath,
          toolToBeUsed[i].replace(".zip", "")
        );
        console.log("zip extraction complete , path is ", extractPath);
      }
    }
  }
  return extractPath;
}
